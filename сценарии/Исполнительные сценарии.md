### 1. Обработка записи пациента

**Триггер:** Пациент подтверждает запись на прием в Личном кабинете.

| Шаг | Системное событие / Действие                                                                                                                   | Компоненты системы                                         | Интеграция и Состояние данных                                                              |
| --- | ---------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------- | ------------------------------------------------------------------------------------------ |
| 1   | **Получение запроса.** Сервер API принимает POST-запрос от фронтенда ЛК для записи Пациента:<br>{<br>patientId,<br>doctorId,<br>dateTime<br>}  | API Gateway, Сервер приложения                             |                                                                                            |
| 2   | **Проверка доступности слота.** Система выполняет запрос к СУБД для проверки, свободно ли выбранное время в расписании врача.                  | СУБД, Сервис расписания                                    | Запрос выполняется с уровнем изоляции, предотвращающим двойную запись                      |
| 3   | **Блокировка слота.** Если слот свободен, система его блокирует (статус "забронирован"), создавая предварительную запись.                      | СУБД, Сервис расписания                                    | Слот становится недоступен для других пользователей на короткое время (например, 10 минут) |
| 4   | **Создание события записи.** В таблицу "Schedules" вносится запись со статусом "confirmed"                                                     | СУБД                                                       |                                                                                            |
| 5   | **Асинхронные уведомления.** Система инициирует фоновые задачи:  <br>• Отправка SMS/email пациенту.  <br>• Добавление уведомления для врача    | Очередь сообщений (Kafka), Сервис уведомлений (Email, SMS) | Пользователь сразу вижет подтверждение, а отправка уведомлений не задерживает ответ        |
| 6   | **Обновление кэша расписания.** Очищается кэш расписания данного врача на данный день, чтобы изменения сразу отобразились у всех пользователей | Кэш (Redis)                                                | Обеспечение консистентности данных между всеми                                             |
и так далее по остальным сценариям